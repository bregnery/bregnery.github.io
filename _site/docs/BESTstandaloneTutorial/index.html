<!DOCTYPE html>
<html>

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123723645-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123723645-1');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>BEST Using the Standalone Function</title>
    <meta name="description" content="This guide has been adapted from the instructions by justinrpilotand demarley.">


    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">

    <link rel="shortcut icon" href="/favicon.ico?1">
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>BEST Using the Standalone Function | Brendan Regnery</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="BEST Using the Standalone Function" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This guide has been adapted from the instructions by justinrpilot and demarley." />
<meta property="og:description" content="This guide has been adapted from the instructions by justinrpilot and demarley." />
<link rel="canonical" href="http://localhost:4000/docs/BESTstandaloneTutorial/" />
<meta property="og:url" content="http://localhost:4000/docs/BESTstandaloneTutorial/" />
<meta property="og:site_name" content="Brendan Regnery" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-06T14:25:04+02:00" />
<script type="application/ld+json">
{"description":"This guide has been adapted from the instructions by justinrpilot and demarley.","@type":"WebPage","url":"http://localhost:4000/docs/BESTstandaloneTutorial/","headline":"BEST Using the Standalone Function","dateModified":"2019-07-06T14:25:04+02:00","datePublished":"2019-07-06T14:25:04+02:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="canonical" href="http://localhost:4000/docs/BESTstandaloneTutorial/">
    <link rel="alternate" type="application/rss+xml" title="Brendan Regnery" href="http://localhost:4000/feed.xml" />
</head>


<body>

    <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container navbar-container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
            <a class="navbar-brand" href="/">
                <span><img src="/img/logonav.png"></span> Brendan Regnery
            </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li  class="active" ><a href="/docs/home/">Research</a></li>
                <li ><a href="/cv/main/">CV</a></li>
                <li ><a href="/ecology/main/">Beyond Physics</a></li>
                <li ><a href="/blog/2018/08/18/gradOPS/">Blog</a></li>
            </ul>
            <div class="navbar-right">
                <form class="navbar-form navbar-left">
                    <div class="form-group has-feedback">
                        <input id="search-box" type="text" class="form-control" placeholder="Search...">
                        <i class="fa fa-search form-control-feedback"></i>
                    </div>
                </form>
                <ul class="nav navbar-nav">
                    <li><a href="https://github.com/bregnery/bregnery.github.io"><i class="fa fa-github" aria-hidden="true"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>


    <div class="page-content">
        <div class="wrapper">
            <div class="container">
    <div class="row">
        <div class="col-md-4">
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-1" aria-expanded="false" aria-controls="collapse-1">
          My Research
        </a>
      </h4>
    </div>
    <div id="collapse-1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/docs/home/">Introduction</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
          Tutorials
        </a>
      </h4>
    </div>
    <div id="collapse-2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/docs/MonteCarloProduction2016/">Monte Carlo Production with the 2016 CMS Scheme</a>
        
          
          
          <a class="list-group-item " href="/docs/FEWZtutorial/">FEWZ Tutorial</a>
        
          
          
          <a class="list-group-item active" href="/docs/BESTstandaloneTutorial/">BEST Using the Standalone Function</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
          Resources
        </a>
      </h4>
    </div>
    <div id="collapse-3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/docs/monteCarloProduction/">Resources for CMS Monte Carlo Production</a>
        
          
          
          <a class="list-group-item " href="/docs/cscIntroResources/">Introductory Resources for CSCs</a>
        
      </ul>
    </div>
  </div>

</div>

        </div>

        <div class="col-md-8">
            <h1>BEST Using the Standalone Function</h1>
            <div id="markdown-content-container"><p>This guide has been adapted from the instructions by <a href="https://github.com/justinrpilot/BESTAnalysis/tree/master">justinrpilot</a>
and <a href="https://github.com/demarley/lwtnn/tree/CMSSW_8_0_X-compatible#cmssw-compatibility">demarley</a>.</p>

<h2 id="introduction">Introduction</h2>

<p>BEST: Boosted Event Shape Tagger is a neural network that was trained to identify AK8 jets that come
from heavy Standard Model particles. This neural network was developed by CMS analysts and is
available on GitHub from <a href="https://github.com/justinrpilot/BESTAnalysis/tree/master">justinrpilot</a>. 
Information about how BEST was trained is available on <a href="https://arxiv.org/pdf/1606.06859.pdf">arXiv</a>.
This guide describes how to use BEST as a function in a CMS EDAnalyzer.</p>

<h2 id="instructions">Instructions</h2>

<h3 id="dependencies">Dependencies</h3>

<p>BEST requires CMSSW and was configured on CERN’s lxplus and Fermilab’s lpc. The BEST standalone function can be used with <code class="highlighter-rouge">CMSSW_9_4_X</code>.
In order to install CMSSW on lxplus, execute the following</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmsrel CMSSW_9_4_8
<span class="nb">cd </span>CMSSW_9_4_8/src/
scram b
cmsenv
</code></pre></div></div>

<h3 id="installation">Installation</h3>

<p>BEST was programmed in python and trained using <a href="http://scikit-learn.org/stable/index.html">scikit-learn</a>. However, the standard 
EDAnalyzer in CMS uses C++, so BEST requires an additional package in order to become a C++ function. This package can be
found <a href="https://github.com/demarley/lwtnn/tree/CMSSW_8_0_X-compatible">here</a>. The first step in setting up BEST is installing
this package [2]:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/
<span class="nb">mkdir </span>lwtnn
<span class="nb">cd </span>lwtnn
git clone https://github.com/demarley/lwtnn.git
<span class="nb">cd </span>lwtnn
git checkout CMSSW_8_0_X-compatible
scram b <span class="nt">-j8</span>
</code></pre></div></div>

<p>Now, BEST can be installed and compiled [1].</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/
git clone https://github.com/cms-ttbarAC/BESTAnalysis.git 
<span class="nb">cd </span>BESTAnalysis
git checkout master
<span class="nb">cd </span>BoostedEventShapeTagger
scram b <span class="nt">-j8</span>
</code></pre></div></div>

<p>This configuration allows for BEST to be use as a function in CMS’s EDAnalyzer [1].</p>

<h3 id="using-the-best-function">Using the BEST function</h3>

<p>EDAnalyzer modules allow analysts to interact with the CMS framework in order to study physics data. I will not go
into great detail about how to use EDAnalyzer, because there is already a great tutorial in the 
<a href="https://twiki.cern.ch/twiki/bin/view/CMSPublic/WorkBookWriteFrameworkModule">CMS work book</a>. I did
include a couple of useful instructions from this tutorial to get the BEST function up and running.</p>

<h4 id="getting-an-edanalyzer-template">Getting an EDAnalyzer Template</h4>

<p>A template EDAnalyzer can be automatically created by CMSSW.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/
<span class="nb">mkdir </span>Demo
<span class="nb">cd </span>Demo
mkedanalyzer DemoAnalyzer
<span class="nb">cd </span>DemoAnalyzer
scram b
</code></pre></div></div>
<h4 id="edit-the-edanalyzer">Edit the EDAnalyzer</h4>

<p>The directory <code class="highlighter-rouge">CMSSSW_9_4_8/src/Demo/DemoAnalyzer/plugins</code> contains several files that need to be altered. First, 
add the necessary functions to the <code class="highlighter-rouge">BuildFile.xml</code> [1].</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;use</span> <span class="na">name=</span><span class="s">"lwtnn/lwtnn"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;use</span> <span class="na">name=</span><span class="s">"BESTAnalysis/BoostedEventShapeTagger"</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>In the same directory, the DemoAnalyzer.cc file must also be altered [1].</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// In the include files</span>
<span class="cp">#include "FWCore/ServiceRegistry/interface/Service.h"
#include "CommonTools/UtilAlgos/interface/TFileService.h"
#include "TTree.h"
#include "TFile.h"
#include "BESTAnalysis/BoostedEventShapeTagger/interface/BoostedEventShapeTagger.h"
#include "DataFormats/PatCandidates/interface/Jet.h"
</span>
<span class="c1">// In the class, under private:</span>
<span class="n">BoostedEventShapeTagger</span> <span class="o">*</span><span class="n">m_BEST</span><span class="p">;</span>
<span class="n">TTree</span> <span class="o">*</span><span class="n">bestTree</span><span class="p">;</span>
<span class="n">edm</span><span class="o">::</span><span class="n">EDGetTokenT</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pat</span><span class="o">::</span><span class="n">Jet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ak8JetsToken_</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">treeVars</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">listOfVars</span><span class="p">;</span>

<span class="c1">// In the constructor pass the name of the configuration file</span>
<span class="n">m_BEST</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoostedEventShapeTagger</span><span class="p">(</span> <span class="s">"/full_path/BESTAnalysis/BoostedEventShapeTagger/data/config.txt"</span> <span class="p">);</span>
   <span class="c1">// Use TFile service to create a tree to store histogram variables</span>
<span class="n">edm</span><span class="o">::</span><span class="n">Service</span><span class="o">&lt;</span><span class="n">TFileService</span><span class="o">&gt;</span> <span class="n">fs</span><span class="p">;</span>
<span class="n">bestTree</span> <span class="o">=</span> <span class="n">fs</span><span class="o">-&gt;</span><span class="n">make</span><span class="o">&lt;</span><span class="n">TTree</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"bestTree"</span><span class="p">,</span><span class="s">"bestTree"</span><span class="p">);</span>
   <span class="c1">// Create tree variables and branches</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_particleType"</span><span class="p">);</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_dnn_w"</span><span class="p">);</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_dnn_z"</span><span class="p">);</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_dnn_h"</span><span class="p">);</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_dnn_top"</span><span class="p">);</span>
<span class="n">listOfVars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">"jet1_dnn_qcd"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">listOfVars</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
   <span class="n">treeVars</span><span class="p">[</span> <span class="n">listOfVars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.99</span><span class="p">;</span>
   <span class="n">bestTree</span><span class="o">-&gt;</span><span class="n">Branch</span><span class="p">(</span> <span class="p">(</span><span class="n">listOfVars</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">c_str</span><span class="p">()</span> <span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">treeVars</span><span class="p">[</span> <span class="n">listOfVars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]),</span> <span class="p">(</span><span class="n">listOfVars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">"/F"</span><span class="p">).</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>
   <span class="c1">// Define input tags</span>
<span class="n">edm</span><span class="o">::</span><span class="n">InputTag</span> <span class="n">ak8JetsTag_</span><span class="p">;</span>
<span class="n">ak8JetsTag_</span> <span class="o">=</span> <span class="n">edm</span><span class="o">::</span><span class="n">InputTag</span><span class="p">(</span><span class="s">"slimmedJetsAK8"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">"PAT"</span><span class="p">);</span>
<span class="n">ak8JetsToken_</span> <span class="o">=</span> <span class="n">consumes</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pat</span><span class="o">::</span><span class="n">Jet</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">ak8JetsTag_</span><span class="p">);</span>

<span class="c1">// In the destructor</span>
<span class="k">delete</span> <span class="n">m_BEST</span><span class="p">;</span>

<span class="c1">// In the event loop</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">edm</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
   <span class="c1">// Find objects corresponding to the token and link to the handle</span>
<span class="n">Handle</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pat</span><span class="o">::</span><span class="n">Jet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ak8Jets</span><span class="p">;</span>
<span class="n">iEvent</span><span class="p">.</span><span class="n">getByToken</span><span class="p">(</span><span class="n">ak8JetsToken_</span><span class="p">,</span> <span class="n">ak8Jets</span><span class="p">);</span>
   <span class="c1">// loop over the jets</span>
<span class="kt">int</span> <span class="n">nJets</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pat</span><span class="o">::</span><span class="n">Jet</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">jetBegin</span> <span class="o">=</span> <span class="n">ak8Jets</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">(),</span> <span class="n">jetEnd</span> <span class="o">=</span> <span class="n">ak8Jets</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">(),</span> <span class="n">ijet</span> <span class="o">=</span> <span class="n">jetBegin</span><span class="p">;</span> <span class="n">ijet</span> <span class="o">!=</span> <span class="n">jetEnd</span><span class="p">;</span> <span class="o">++</span><span class="n">ijet</span><span class="p">){</span>
      <span class="c1">// These are the requirements for a Jet to be used with BEST</span>
   <span class="k">if</span><span class="p">(</span><span class="n">ijet</span><span class="o">-&gt;</span><span class="n">numberOfDaughters</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">ijet</span><span class="o">-&gt;</span><span class="n">pt</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">500</span> <span class="o">&amp;&amp;</span> <span class="n">ijet</span><span class="o">-&gt;</span><span class="n">userFloat</span><span class="p">(</span><span class="s">"ak8PFJetsCHSSoftDropMass"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">40</span> <span class="p">){</span>
      <span class="n">nJets</span><span class="o">++</span><span class="p">;</span>
      <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">NNresults</span> <span class="o">=</span> <span class="n">m_BEST</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">ijet</span><span class="p">);</span>  <span class="c1">// ijet is a pat::Jet</span>
      <span class="kt">int</span> <span class="n">particleType</span> <span class="o">=</span> <span class="n">m_BEST</span><span class="o">-&gt;</span><span class="n">getParticleID</span><span class="p">();</span>                      <span class="c1">// automatically calculate the particle classification</span>
      <span class="k">if</span><span class="p">(</span><span class="n">nJets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_particleType"</span><span class="p">]</span> <span class="o">=</span> <span class="n">particleType</span><span class="p">;</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_dnn_w"</span><span class="p">]</span> <span class="o">=</span> <span class="n">NNresults</span><span class="p">[</span><span class="s">"dnn_w"</span><span class="p">];</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_dnn_z"</span><span class="p">]</span> <span class="o">=</span> <span class="n">NNresults</span><span class="p">[</span><span class="s">"dnn_z"</span><span class="p">];</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_dnn_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">NNresults</span><span class="p">[</span><span class="s">"dnn_higgs"</span><span class="p">];</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_dnn_top"</span><span class="p">]</span> <span class="o">=</span> <span class="n">NNresults</span><span class="p">[</span><span class="s">"dnn_top"</span><span class="p">];</span>
         <span class="n">treeVars</span><span class="p">[</span><span class="s">"jet1_dnn_qcd"</span><span class="p">]</span> <span class="o">=</span> <span class="n">NNresults</span><span class="p">[</span><span class="s">"dnn_qcd"</span><span class="p">];</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
   <span class="c1">// Fill the tree that stores the NNresults</span>
<span class="n">bestTree</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">();</span>

</code></pre></div></div>

<p>Now, in order to properly compile everything, the BESTAnalyzer and BESTProducer directories must be
removed as they are not compatible with CMSSW_9_X.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/
<span class="nb">rm</span> <span class="nt">-r</span> <span class="nt">-f</span> BESTAnalysis/BESTAnalyzer/
<span class="nb">rm</span> <span class="nt">-r</span> <span class="nt">-f</span> BESTAnalysis/BESTProducer/
</code></pre></div></div>

<p>Finally, in the file <code class="highlighter-rouge">BESTAnalysis/BoostedEventShapeTagger/data/config.txt</code> the <code class="highlighter-rouge">dnnFile</code> must be updated
to include the full path. After this, everything can be compiled.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/
scram b <span class="nt">-j8</span>
</code></pre></div></div>

<p>Now a <code class="highlighter-rouge">run.py</code> file must be created in order to use the EDAnalyzer. The run file should be made in 
<code class="highlighter-rouge">CMSSW_9_4_8/src/Demo/DemoAnalyzer/test</code> and should include the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">FWCore.ParameterSet.Config</span> <span class="k">as</span> <span class="n">cms</span>


<span class="n">process</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="s">"run"</span><span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">"FWCore.MessageService.MessageLogger_cfi"</span><span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">maxEvents</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">PSet</span><span class="p">(</span> <span class="nb">input</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="s">"PoolSource"</span><span class="p">,</span>
    <span class="c1"># replace 'myfile.root' with the source file you want to use
</span>    <span class="n">fileNames</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">vstring</span><span class="p">(</span>
        <span class="s">"file:myfile.root"</span>
        <span class="p">)</span>
<span class="p">)</span>
<span class="n">process</span><span class="o">.</span><span class="n">MessageLogger</span><span class="o">.</span><span class="n">cerr</span><span class="o">.</span><span class="n">FwkReport</span><span class="o">.</span><span class="n">reportEvery</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">process</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">EDAnalyzer</span><span class="p">(</span><span class="s">'DemoAnalyzer'</span><span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">TFileService</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s">"TFileService"</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s">"best_results.root"</span><span class="p">)</span> <span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">OutputModule</span><span class="p">(</span><span class="s">"PoolOutputModule"</span><span class="p">,</span>
                               <span class="n">fileName</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s">"ana_out.root"</span><span class="p">),</span>
                               <span class="n">SelectEvents</span>   <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">PSet</span><span class="p">(</span> <span class="n">SelectEvents</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">vstring</span><span class="p">(</span><span class="s">'p'</span><span class="p">)</span> <span class="p">),</span>
                               <span class="n">outputCommands</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">untracked</span><span class="o">.</span><span class="n">vstring</span><span class="p">(</span><span class="s">'drop *'</span><span class="p">,</span>
                                                                      <span class="s">'keep *_*run*_*_*'</span>
                                                                      <span class="c1">#, 'keep *_goodPatJetsCATopTagPF_*_*'
</span>                                                                      <span class="c1">#, 'keep recoPFJets_*_*_*'
</span>                                                                      <span class="p">)</span>
                               <span class="p">)</span>
<span class="n">process</span><span class="o">.</span><span class="n">outpath</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">EndPath</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>

<span class="n">process</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
</code></pre></div></div>

<p>Now the EDAnalyzer can be run!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>CMSSW_9_4_8/src/Demo/DemoAnalyzer/test/
cmsenv
cmsRun run.py
</code></pre></div></div>
<p>The output will be <code class="highlighter-rouge">best_results.root</code> which contains the BEST probabilities for the first
AK8 jet identified in an event. This process can be expanded to include the BEST probability
results for all of the AK8 jets in an event. Below is a table explaining what each of the 
NNresults strings mean [1].</p>

<table>
  <thead>
    <tr>
      <th>String</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">dnn_w</code></td>
      <td>BEST’s calculated probability that the AK8 jet is from a W boson</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">dnn_z</code></td>
      <td>BEST’s calculated probability that the AK8 jet is from a Z boson</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">dnn_higgs</code></td>
      <td>BEST’s calculated probability that the AK8 jet is from a Higgs boson</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">dnn_top</code></td>
      <td>BEST’s calculated probability that the AK8 jet is from a top quark</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">dnn_qcd</code></td>
      <td>BEST’s calculated probability that the AK8 jet is from a QCD background</td>
    </tr>
  </tbody>
</table>

<h2 id="references">References</h2>

<ol>
  <li>justinrpilot, BESTAnalysis, https://github.com/justinrpilot/BESTAnalysis/tree/master</li>
  <li>demarley, lwtnn, https://github.com/demarley/lwtnn/tree/CMSSW_8_0_X-compatible#cmssw-compatibility</li>
</ol>

</div>
            <p class="text-center">
              <br />
              <a target="_blank" href="https://github.com/bregnery/bregnery.github.io/tree/master/_docs/tutorials/BESTstandaloneTutorial.md" class="btn btn-default githubEditButton" role="button">
                <i class="fa fa-pencil fa-lg"></i> Improve this page
              </a>
            </p>
            <hr>
            





  
  

  
  

  
  

  
  
    <ul class="pager">
      
        
        
        <li class="previous">
          <a href="/docs/FEWZtutorial/">
            <span aria-hidden="true">&larr;</span> Previous
          </a>
        </li>
      

      
        
        
        <li class="next">
          <a href="/docs/monteCarloProduction/">
            Next <span aria-hidden="true">&rarr;</span>
          </a>
        </li>
      
    </div>
    <div class="clear"></div>
    

        </div>

    </div>
</div>

        </div>
    </div>

    <footer class="footer">
    <div class="container">

        <p class="text-center">
            Brendan Regnery 2019 |
            Powered by <a href="https://github.com/aksakalli/jekyll-doc-theme">Jekyll Doc Theme</a>
        </p>
        <!-- <p class="text-muted">Place sticky footer content here.</p> -->
    </div>
</footer>

    <script>
  var baseurl = ''
</script>
<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="/js/bootstrap.min.js "></script>
<script src="/js/typeahead.bundle.min.js "></script>

<script src="/js/main.js "></script>

</body>

</html>
